<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Manage Recipes | RecipeApp</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 950px;
        }
        .table th {
            background-color: #d1e7dd;
        }
    </style>
</head>

<body class="d-flex flex-column align-items-center justify-content-start py-5">
<div class="container">
    <h2 class="text-success fw-bold text-center mb-4">üç≥ Manage Recipes</h2>
    <a href="/admin/mealdb" class="btn btn-outline-success mb-3">üåê Import from TheMealDB</a>

    <!-- ‚úÖ ÊàêÂäüÊèêÁ§∫ -->
    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${successMessage}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <!-- ‚ö†Ô∏è ÈîôËØØÊèêÁ§∫ -->
    <div th:if="${errorMessage}" class="alert alert-warning alert-dismissible fade show" role="alert">
        <span th:text="${errorMessage}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <!-- ‚úÖ ÂØºÂÖ•Â§ñÈÉ®ËèúË∞±Ë°®Âçï -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="card-title text-success">Import Recipe from TheMealDB</h5>
            <p class="text-muted small">
                Enter a recipe ID from
                <a href="https://www.themealdb.com/" target="_blank">TheMealDB</a>
                to import it into your database.
            </p>
            <form id="importForm" class="d-flex justify-content-center">
                <input type="text" id="recipeId" class="form-control w-50 me-2" placeholder="e.g. 52772" required>
                <button type="submit" class="btn btn-success">Import Recipe</button>
            </form>
        </div>
    </div>

    <!-- ‚úÖ Â∑≤ÂØºÂÖ•ËèúË∞±ÂàóË°® -->
    <div class="card shadow-sm">
        <div class="card-body">
            <h5 class="card-title text-success mb-3">üìã Imported Recipes</h5>

            <table class="table table-striped table-hover align-middle">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Category</th>
                    <th>Cuisine</th>
                    <th>Source</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <!-- ‚úÖ Èò≤Á©∫‰øùÊä§ -->
                <tr th:if="${recipes == null or #lists.isEmpty(recipes)}">
                    <td colspan="6" class="text-center text-muted py-4">No recipes found.</td>
                </tr>

                <!-- ‚úÖ Âæ™ÁéØÊòæÁ§∫ËèúË∞± -->
                <tr th:each="recipe : ${recipes}" th:if="${recipes != null}">
                    <td th:text="${recipe.id}">1</td>
                    <td th:text="${recipe.name}">Sample</td>
                    <td th:text="${recipe.category == null ? '-' : recipe.category.name}">Category</td>
                    <td th:text="${recipe.cuisine == null ? '-' : recipe.cuisine.name}">Cuisine</td>
                    <td>
                        <a th:if="${recipe.sourceUrl != null}" th:href="${recipe.sourceUrl}"
                           target="_blank" class="btn btn-sm btn-outline-secondary">View</a>
                        <span th:if="${recipe.sourceUrl == null}">N/A</span>
                    </td>
                    <td>
                        <div class="d-flex gap-2">
                            <!-- üîß ÁºñËæë -->
                            <a th:href="@{'/admin/recipes/edit/' + ${recipe.id}}"
                               class="btn btn-sm btn-outline-primary">Edit</a>

                            <!-- üóë Âà†Èô§ -->
                            <form th:action="@{'/admin/recipes/delete/' + ${recipe.id}}" method="post"
                                  onsubmit="return confirm('‚ö†Ô∏è Are you sure you want to delete this recipe?')">
                                <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                            </form>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="text-center mt-4">
        <a href="/admin/dashboard" class="btn btn-outline-secondary">‚¨Ö Back to Dashboard</a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // ‚úÖ ÂØºÂÖ•ÊåâÈíÆ‰∫ã‰ª∂
    document.getElementById("importForm").addEventListener("submit", function (e) {
        e.preventDefault();
        const recipeId = document.getElementById("recipeId").value.trim();
        if (recipeId) {
            window.location.href = `/admin/recipes/import/${recipeId}`;
        }
    });
</script>
</body>
</html>
